<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>El rey del mueble</title>
  <link rel="stylesheet" href="css/global.css">
  <link rel="stylesheet" href="css/detallesprod.css">
  <script rel="preload" type="module" src="componentes/header/headerComponent.js"></script>
  <script rel="preload" type="module" src="componentes/footer/footerComponent.js"></script>
</head>
<body>
  <header-component></header-component>
  <main id="main">
    <section class="content_prod">
      <img src="" alt="Esperando los datos de la petición">
      <article class="content_info">
      </article>
    </section>
  </main>
  <footer-component></footer-component>
  <script>
    // Obtiene el valor de los parámetros
    let params = new URLSearchParams(window.location.search);
    let name = params.get('name');
    // Hacer la peticion a una API
    fetch(`https://furniture-api.fly.dev/v1/products?name=${name}`)
      .then(rest => rest.json())
      .then(json => {
        if(!json.data[0]) location.href = "index.html";
        console.log(json);
        
        // QUE HACER CUANDO SE OBTIENE LOS DATOS
        const $content = document.querySelector(".content_prod");
        const $img = $content.querySelector("img");
        const $content_info = $content.querySelector(".content_info");
        const {name, image_path, description, category, price, stock} = json.data[0];

        $img.src = image_path;
        $img.alt = name;

        $content_info.innerHTML = `
          <h1>${name}</h1>
          <p>
            ${description}
          </p>
          <div class="stock">Disponible: <strong>${stock}</strong></div>
          <div class="content_interaction">
            <div class="content_price">
              <div>
                <button id="mas">+</button>
                <span class="cantidad">0</span>
                <button id="menos">-</button>
              </div>
              <span class="price">S/ ${price}.00</span>
            </div>
            <button class="btn_buy">Comprar</button>
          </div>
        `;
        addContador(stock);
      })

      // Funcion para agregar el contador
      function addContador(stock) {
        const $mas = document.getElementById("mas");
        const $menos = document.getElementById("menos");
        const $cantidad = document.querySelector(".cantidad");
        $mas.addEventListener("click", () => {
          const cantidad_num = Number($cantidad.textContent);
          if(cantidad_num < stock) {
            $cantidad.textContent = cantidad_num + 1;
          }
        })
        $menos.addEventListener("click", () => {
          const cantidad_num = Number($cantidad.textContent);
          if(cantidad_num > 0) {
            $cantidad.textContent = cantidad_num - 1;
          }
        })
      }
  </script>
</body>
</html>